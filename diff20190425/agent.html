<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<style>
.AlignLeft { text-align: left; }
.AlignCenter { text-align: center; }
.AlignRight { text-align: right; }
body { font-family: sans-serif; font-size: 11pt; }
td { vertical-align: top; padding-left: 4px; padding-right: 4px; }

tr.SectionGap td { font-size: 4px; border-left: none; border-top: none; border-bottom: 1px solid Black; border-right: 1px solid Black; }
tr.SectionAll td { border-left: none; border-top: none; border-bottom: 1px solid Black; border-right: 1px solid Black; }
tr.SectionBegin td { border-left: none; border-top: none; border-right: 1px solid Black; }
tr.SectionEnd td { border-left: none; border-top: none; border-bottom: 1px solid Black; border-right: 1px solid Black; }
tr.SectionMiddle td { border-left: none; border-top: none; border-right: 1px solid Black; }
tr.SubsectionAll td { border-left: none; border-top: none; border-bottom: 1px solid Gray; border-right: 1px solid Black; }
tr.SubsectionEnd td { border-left: none; border-top: none; border-bottom: 1px solid Gray; border-right: 1px solid Black; }
table.fc { border-top: 1px solid Black; border-left: 1px solid Black; width: 100%; font-family: monospace; font-size: 10pt; }
td.TextItemInsigAdd { color: #000000; background-color: #EFEFFF; }
td.TextItemInsigDel { color: #000000; background-color: #EFEFFF; text-decoration: line-through; }
td.TextItemInsigDiffMod { color: #000000; background-color: #EFEFFF; }
td.TextItemInsigLeftMod { color: #000000; background-color: #EFEFFF; }
td.TextItemInsigRightMod { color: #000000; background-color: #EFEFFF; }
td.TextItemNum { color: #827357; background-color: #F2F2F2; }
td.TextItemSame { color: #000000; background-color: #FFFFFF; }
td.TextItemSigAdd { color: #000000; background-color: #FFE3E3; }
td.TextItemSigDel { color: #000000; background-color: #FFE3E3; text-decoration: line-through; }
td.TextItemSigDiffMod { color: #000000; background-color: #FFE3E3; }
td.TextItemSigLeftMod { color: #000000; background-color: #FFE3E3; }
td.TextItemSigRightMod { color: #000000; background-color: #FFE3E3; }
.TextSegInsigDiff { color: #0000FF; }
.TextSegReplacedDiff { color: #0000FF; font-style: italic; }
.TextSegSigDiff { color: #FF0000; }
</style>
<title>agent.diff</title>
</head>
<body>
agent.diff<br/>
生成： 2019/7/12 10:10:18<br/>
&nbsp; &nbsp;
<br/>
模式：&nbsp; 所有 &nbsp;
<br/>
左侧文件： C:\Users\frank\AppData\Local\Temp\TortoiseGit\agent-ea5cdd0.000.go &nbsp;
<br/>
右侧文件： E:\go\fssgo\src\github.com\pion\ice\agent.go &nbsp;
<br/>
<table class="fc" cellspacing="0" cellpadding="0">
<tr class="SectionBegin">
<td class="TextItemSame">// Package ice implements the Interactive Connectivity Establishment (ICE)</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">// Package ice implements the Interactive Connectivity Establishment (ICE)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// protocol defined in rfc5245.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// protocol defined in rfc5245.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">package ice</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">package ice</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">import (</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">import (</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;bytes&quot;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;bytes&quot;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;math/rand&quot;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;math/rand&quot;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;net&quot;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;net&quot;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;sort&quot;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;sort&quot;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;sync&quot;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;sync&quot;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;sync/atomic&quot;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;sync/atomic&quot;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;time&quot;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;time&quot;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;github.com/pion/logging&quot;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;github.com/pion/logging&quot;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;github.com/pion/stun&quot;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;github.com/pion/stun&quot;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;github.com/pion/transport/packetio&quot;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &quot;github.com/pion/transport/packetio&quot;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">const (</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">const (</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // taskLoopInterval is the interval at which the agent performs checks</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // taskLoopInterval is the interval at which the agent performs checks</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; defaultTaskLoopInterval = 2 * time.Second</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; defaultTaskLoopInterval = 2 * time.Second</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // keepaliveInterval used to keep candidates alive</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // keepaliveInterval used to keep candidates alive</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; defaultKeepaliveInterval = 10 * time.Second</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; defaultKeepaliveInterval = 10 * time.Second</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // defaultConnectionTimeout used to declare a connection dead</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // defaultConnectionTimeout used to declare a connection dead</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; defaultConnectionTimeout = 30 * time.Second</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; defaultConnectionTimeout = 30 * time.Second</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // the number of bytes that can be buffered before we start to error</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // the number of bytes that can be buffered before we start to error</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; maxBufferSize = 1000 * 1000 // 1MB</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; maxBufferSize = 1000 * 1000 // 1MB</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // the number of outbound binding requests we cache</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // the number of outbound binding requests we cache</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; maxPendingBindingRequests = 50</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; maxPendingBindingRequests = 50</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; stunAttrHeaderLength = 4</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; stunAttrHeaderLength = 4</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">type candidatePairs []*candidatePair</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">type candidatePairs []*candidatePair</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (cp candidatePairs) Len() int&nbsp; &nbsp; &nbsp; { return len(cp) }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (cp candidatePairs) Len() int&nbsp; &nbsp; &nbsp; { return len(cp) }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (cp candidatePairs) Swap(i, j int) { cp[i], cp[j] = cp[j], cp[i] }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (cp candidatePairs) Swap(i, j int) { cp[i], cp[j] = cp[j], cp[i] }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">type byPairPriority struct{ candidatePairs }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">type byPairPriority struct{ candidatePairs }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// NB: Reverse sort so our candidates start at highest priority</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// NB: Reverse sort so our candidates start at highest priority</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (bp byPairPriority) Less(i, j int) bool {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (bp byPairPriority) Less(i, j int) bool {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return bp.candidatePairs[i].Priority() &gt; bp.candidatePairs[j].Priority()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return bp.candidatePairs[i].Priority() &gt; bp.candidatePairs[j].Priority()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">type bindingRequest struct {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">type bindingRequest struct {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; transactionID []byte</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; transactionID []byte</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; destination&nbsp;&nbsp; net.Addr</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; destination&nbsp;&nbsp; net.Addr</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// Agent represents the ICE agent</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// Agent represents the ICE agent</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">type Agent struct {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">type Agent struct {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; onConnectionStateChangeHdlr&nbsp; &nbsp; &nbsp;&nbsp; func(ConnectionState)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; onConnectionStateChangeHdlr&nbsp; &nbsp; &nbsp;&nbsp; func(ConnectionState)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; onSelectedCandidatePairChangeHdlr func(*Candidate, *Candidate)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; onSelectedCandidatePairChangeHdlr func(*Candidate, *Candidate)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // Used to block double Dial/Accept</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // Used to block double Dial/Accept</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; opened bool</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; opened bool</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // State owned by the taskLoop</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // State owned by the taskLoop</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; taskChan&nbsp; &nbsp; &nbsp; &nbsp; chan task</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; taskChan&nbsp; &nbsp; &nbsp; &nbsp; chan task</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; onConnected&nbsp; &nbsp;&nbsp; chan struct{}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; onConnected&nbsp; &nbsp;&nbsp; chan struct{}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; onConnectedOnce sync.Once</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; onConnectedOnce sync.Once</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; connectivityChan &lt;-chan time.Time</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; connectivityChan &lt;-chan time.Time</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // force candidate to be contacted immediately (instead of waiting for connectivityChan)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // force candidate to be contacted immediately (instead of waiting for connectivityChan)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; forceCandidateContact chan bool</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; forceCandidateContact chan bool</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; tieBreaker&nbsp; &nbsp; &nbsp; uint64</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; tieBreaker&nbsp; &nbsp; &nbsp; uint64</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; connectionState ConnectionState</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; connectionState ConnectionState</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; gatheringState&nbsp; GatheringState</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; gatheringState&nbsp; GatheringState</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; haveStarted&nbsp;&nbsp; atomic.Value</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; haveStarted&nbsp;&nbsp; atomic.Value</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; isControlling bool</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; isControlling bool</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; portmin uint16</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; portmin uint16</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; portmax uint16</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; portmax uint16</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; //How long should a pair stay quiet before we declare it dead?</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; //How long should a pair stay quiet before we declare it dead?</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; //0 means never timeout</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; //0 means never timeout</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; connectionTimeout time.Duration</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; connectionTimeout time.Duration</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; //How often should we send keepalive packets?</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; //How often should we send keepalive packets?</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; //0 means never</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; //0 means never</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; keepaliveInterval time.Duration</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; keepaliveInterval time.Duration</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // How after should we run our internal taskLoop</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // How after should we run our internal taskLoop</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; taskLoopInterval time.Duration</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; taskLoopInterval time.Duration</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; localUfrag&nbsp; &nbsp; &nbsp; string</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; localUfrag&nbsp; &nbsp; &nbsp; string</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; localPwd&nbsp; &nbsp; &nbsp; &nbsp; string</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; localPwd&nbsp; &nbsp; &nbsp; &nbsp; string</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; localCandidates map[NetworkType][]*Candidate</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; localCandidates map[NetworkType][]*Candidate</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remoteUfrag&nbsp; &nbsp; &nbsp; string</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remoteUfrag&nbsp; &nbsp; &nbsp; string</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remotePwd&nbsp; &nbsp; &nbsp; &nbsp; string</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remotePwd&nbsp; &nbsp; &nbsp; &nbsp; string</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remoteCandidates map[NetworkType][]*Candidate</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remoteCandidates map[NetworkType][]*Candidate</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; selectedPair *candidatePair</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; selectedPair *candidatePair</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; validPairs&nbsp;&nbsp; []*candidatePair</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; validPairs&nbsp;&nbsp; []*candidatePair</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; buffer *packetio.Buffer</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; buffer *packetio.Buffer</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // LRU of outbound Binding request Transaction IDs</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // LRU of outbound Binding request Transaction IDs</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; pendingBindingRequests []bindingRequest</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; pendingBindingRequests []bindingRequest</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // State for closing</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // State for closing</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; done chan struct{}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; done chan struct{}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; err&nbsp; atomicError</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; err&nbsp; atomicError</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; log logging.LeveledLogger</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; log logging.LeveledLogger</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">-+</td>
<td class="TextItemInsigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">IceConn</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">net.Conn</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">}</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) ok() error {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) ok() error {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; select {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; select {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case &lt;-a.done:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case &lt;-a.done:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return a.getErr()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return a.getErr()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; default:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; default:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return nil</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return nil</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) getErr() error {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) getErr() error {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; err := a.err.Load()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; err := a.err.Load()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return err</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return err</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return ErrClosed</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return ErrClosed</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// AgentConfig collects the arguments to ice.Agent construction into</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// AgentConfig collects the arguments to ice.Agent construction into</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// a single structure, for future-proofness of the interface</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// a single structure, for future-proofness of the interface</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">type AgentConfig struct {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">type AgentConfig struct {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; Urls []*URL</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; Urls []*URL</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // PortMin and PortMax are optional. Leave them 0 for the default UDP port allocation strategy.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // PortMin and PortMax are optional. Leave them 0 for the default UDP port allocation strategy.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; PortMin uint16</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; PortMin uint16</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; PortMax uint16</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; PortMax uint16</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // ConnectionTimeout defaults to 30 seconds when this property is nil.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // ConnectionTimeout defaults to 30 seconds when this property is nil.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // If the duration is 0, we will never timeout this connection.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // If the duration is 0, we will never timeout this connection.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; ConnectionTimeout *time.Duration</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; ConnectionTimeout *time.Duration</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // KeepaliveInterval determines how often should we send ICE</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // KeepaliveInterval determines how often should we send ICE</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // keepalives (should be less then connectiontimeout above)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // keepalives (should be less then connectiontimeout above)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // when this is nil, it defaults to 10 seconds.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // when this is nil, it defaults to 10 seconds.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // A keepalive interval of 0 means we never send keepalive packets</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // A keepalive interval of 0 means we never send keepalive packets</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; KeepaliveInterval *time.Duration</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; KeepaliveInterval *time.Duration</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // NetworkTypes is an optional configuration for disabling or enablding</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // NetworkTypes is an optional configuration for disabling or enablding</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // support for specific network types.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // support for specific network types.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; NetworkTypes []NetworkType</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; NetworkTypes []NetworkType</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; LoggerFactory logging.LoggerFactory</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; LoggerFactory logging.LoggerFactory</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // taskLoopInterval controls how often our internal task loop runs, this</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // taskLoopInterval controls how often our internal task loop runs, this</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // task loop handles things like sending keepAlives. This is only value for testing</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // task loop handles things like sending keepAlives. This is only value for testing</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // keepAlive behavior should be modified with KeepaliveInterval and ConnectionTimeout</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // keepAlive behavior should be modified with KeepaliveInterval and ConnectionTimeout</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; taskLoopInterval time.Duration</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; taskLoopInterval time.Duration</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// NewAgent creates a new Agent</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// NewAgent creates a new Agent</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func NewAgent(config *AgentConfig) (*Agent, error) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func NewAgent(config *AgentConfig) (*Agent, error) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if config.PortMax &lt; config.PortMin {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if config.PortMax &lt; config.PortMin {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return nil, ErrPort</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return nil, ErrPort</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; loggerFactory := config.LoggerFactory</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; loggerFactory := config.LoggerFactory</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if loggerFactory == nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if loggerFactory == nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loggerFactory = logging.NewDefaultLoggerFactory()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loggerFactory = logging.NewDefaultLoggerFactory()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a := &amp;Agent{</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a := &amp;Agent{</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tieBreaker:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rand.New(rand.NewSource(time.Now().UnixNano())).Uint64(),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tieBreaker:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rand.New(rand.NewSource(time.Now().UnixNano())).Uint64(),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gatheringState:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; GatheringStateComplete, // TODO trickle-ice</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gatheringState:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; GatheringStateComplete, // TODO trickle-ice</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; connectionState:&nbsp; &nbsp; &nbsp; &nbsp; ConnectionStateNew,</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; connectionState:&nbsp; &nbsp; &nbsp; &nbsp; ConnectionStateNew,</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; localCandidates:&nbsp; &nbsp; &nbsp; &nbsp; make(map[NetworkType][]*Candidate),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; localCandidates:&nbsp; &nbsp; &nbsp; &nbsp; make(map[NetworkType][]*Candidate),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; remoteCandidates:&nbsp; &nbsp; &nbsp;&nbsp; make(map[NetworkType][]*Candidate),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; remoteCandidates:&nbsp; &nbsp; &nbsp;&nbsp; make(map[NetworkType][]*Candidate),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingBindingRequests: make([]bindingRequest, 0, maxPendingBindingRequests),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingBindingRequests: make([]bindingRequest, 0, maxPendingBindingRequests),</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSigDiffMod">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; localUfrag:&nbsp; randSeq(<span class="TextSegSigDiff">16</span>),</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigDiffMod">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; localUfrag:&nbsp; randSeq(<span class="TextSegSigDiff">4</span>),</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigDiffMod">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; localPwd:&nbsp; &nbsp; randSeq(<span class="TextSegSigDiff">3</span>2),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigDiffMod">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; localPwd:&nbsp; &nbsp; randSeq(<span class="TextSegSigDiff">2</span>2),</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; taskChan:&nbsp; &nbsp; make(chan task),</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; taskChan:&nbsp; &nbsp; make(chan task),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onConnected: make(chan struct{}),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onConnected: make(chan struct{}),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buffer:&nbsp; &nbsp; &nbsp; packetio.NewBuffer(),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buffer:&nbsp; &nbsp; &nbsp; packetio.NewBuffer(),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; done:&nbsp; &nbsp; &nbsp; &nbsp; make(chan struct{}),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; done:&nbsp; &nbsp; &nbsp; &nbsp; make(chan struct{}),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; portmin:&nbsp; &nbsp;&nbsp; config.PortMin,</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; portmin:&nbsp; &nbsp;&nbsp; config.PortMin,</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; portmax:&nbsp; &nbsp;&nbsp; config.PortMax,</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; portmax:&nbsp; &nbsp;&nbsp; config.PortMax,</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; log:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; loggerFactory.NewLogger(&quot;ice&quot;),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; log:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; loggerFactory.NewLogger(&quot;ice&quot;),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; forceCandidateContact: make(chan bool, 1),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; forceCandidateContact: make(chan bool, 1),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.haveStarted.Store(false)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.haveStarted.Store(false)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // Make sure the buffer doesn't grow indefinitely.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // Make sure the buffer doesn't grow indefinitely.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // NOTE: We actually won't get anywhere close to this limit.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // NOTE: We actually won't get anywhere close to this limit.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // SRTP will constantly read from the endpoint and drop packets if it's full.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // SRTP will constantly read from the endpoint and drop packets if it's full.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.buffer.SetLimitSize(maxBufferSize)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.buffer.SetLimitSize(maxBufferSize)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // connectionTimeout used to declare a connection dead</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // connectionTimeout used to declare a connection dead</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if config.ConnectionTimeout == nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if config.ConnectionTimeout == nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.connectionTimeout = defaultConnectionTimeout</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.connectionTimeout = defaultConnectionTimeout</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.connectionTimeout = *config.ConnectionTimeout</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.connectionTimeout = *config.ConnectionTimeout</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if config.KeepaliveInterval == nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if config.KeepaliveInterval == nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.keepaliveInterval = defaultKeepaliveInterval</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.keepaliveInterval = defaultKeepaliveInterval</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.keepaliveInterval = *config.KeepaliveInterval</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.keepaliveInterval = *config.KeepaliveInterval</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if config.taskLoopInterval == 0 {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if config.taskLoopInterval == 0 {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.taskLoopInterval = defaultTaskLoopInterval</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.taskLoopInterval = defaultTaskLoopInterval</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.taskLoopInterval = config.taskLoopInterval</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.taskLoopInterval = config.taskLoopInterval</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // Initialize local candidates</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // Initialize local candidates</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; gatherCandidatesLocal(a, config.NetworkTypes)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; gatherCandidatesLocal(a, config.NetworkTypes)</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; gatherCandidatesReflective(a, config.Urls, config.NetworkTypes)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; gatherCandidatesReflective(a, config.Urls, config.NetworkTypes)</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">-+</td>
<td class="TextItemInsigRightMod">&nbsp;</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">GetIceServer().AddAgent(a)</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; go a.taskLoop()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; go a.taskLoop()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return a, nil</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return a, nil</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// OnConnectionStateChange sets a handler that is fired when the connection state changes</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// OnConnectionStateChange sets a handler that is fired when the connection state changes</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) OnConnectionStateChange(f func(ConnectionState)) error {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) OnConnectionStateChange(f func(ConnectionState)) error {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return a.run(func(agent *Agent) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return a.run(func(agent *Agent) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.onConnectionStateChangeHdlr = f</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.onConnectionStateChangeHdlr = f</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// OnSelectedCandidatePairChange sets a handler that is fired when the final candidate</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// OnSelectedCandidatePairChange sets a handler that is fired when the final candidate</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// pair is selected</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// pair is selected</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) OnSelectedCandidatePairChange(f func(*Candidate, *Candidate)) error {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) OnSelectedCandidatePairChange(f func(*Candidate, *Candidate)) error {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return a.run(func(agent *Agent) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return a.run(func(agent *Agent) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.onSelectedCandidatePairChangeHdlr = f</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.onSelectedCandidatePairChangeHdlr = f</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) onSelectedCandidatePairChange(p *candidatePair) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) onSelectedCandidatePairChange(p *candidatePair) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if p != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if p != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if a.onSelectedCandidatePairChangeHdlr != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if a.onSelectedCandidatePairChangeHdlr != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.onSelectedCandidatePairChangeHdlr(p.local, p.remote)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.onSelectedCandidatePairChangeHdlr(p.local, p.remote)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) startConnectivityChecks(isControlling bool, remoteUfrag, remotePwd string) error {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) startConnectivityChecks(isControlling bool, remoteUfrag, remotePwd string) error {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; switch {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; switch {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case a.haveStarted.Load():</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case a.haveStarted.Load():</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return ErrMultipleStart</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return ErrMultipleStart</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case remoteUfrag == &quot;&quot;:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case remoteUfrag == &quot;&quot;:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return ErrRemoteUfragEmpty</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return ErrRemoteUfragEmpty</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case remotePwd == &quot;&quot;:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case remotePwd == &quot;&quot;:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return ErrRemotePwdEmpty</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return ErrRemotePwdEmpty</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.haveStarted.Store(true)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.haveStarted.Store(true)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.log.Debugf(&quot;Started agent: isControlling? %t, remoteUfrag: %q, remotePwd: %q&quot;, isControlling, remoteUfrag, remotePwd)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.log.Debugf(&quot;Started agent: isControlling? %t, remoteUfrag: %q, remotePwd: %q&quot;, isControlling, remoteUfrag, remotePwd)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return a.run(func(agent *Agent) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return a.run(func(agent *Agent) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.isControlling = isControlling</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.isControlling = isControlling</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.remoteUfrag = remoteUfrag</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.remoteUfrag = remoteUfrag</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.remotePwd = remotePwd</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.remotePwd = remotePwd</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.updateConnectionState(ConnectionStateChecking)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.updateConnectionState(ConnectionStateChecking)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // TODO this should be dynamic, and grow when the connection is stable</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // TODO this should be dynamic, and grow when the connection is stable</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.forceCandidateContact &lt;- true</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.forceCandidateContact &lt;- true</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t := time.NewTicker(a.taskLoopInterval)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t := time.NewTicker(a.taskLoopInterval)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.connectivityChan = t.C</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.connectivityChan = t.C</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) pingCandidate(local, remote *Candidate) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) pingCandidate(local, remote *Candidate) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; var msg *stun.Message</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; var msg *stun.Message</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; var err error</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; var err error</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // The controlling agent MUST include the USE-CANDIDATE attribute in</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // The controlling agent MUST include the USE-CANDIDATE attribute in</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // order to nominate a candidate pair (Section 8.1.1).&nbsp; The controlled</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // order to nominate a candidate pair (Section 8.1.1).&nbsp; The controlled</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // agent MUST NOT include the USE-CANDIDATE attribute in a Binding</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // agent MUST NOT include the USE-CANDIDATE attribute in a Binding</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // request.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // request.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; transactionID := stun.GenerateTransactionID()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; transactionID := stun.GenerateTransactionID()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if a.isControlling {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if a.isControlling {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; msg, err = stun.Build(stun.ClassRequest, stun.MethodBinding, transactionID,</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; msg, err = stun.Build(stun.ClassRequest, stun.MethodBinding, transactionID,</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Username{Username: a.remoteUfrag + &quot;:&quot; + a.localUfrag},</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Username{Username: a.remoteUfrag + &quot;:&quot; + a.localUfrag},</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.UseCandidate{},</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.UseCandidate{},</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.IceControlling{TieBreaker: a.tieBreaker},</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.IceControlling{TieBreaker: a.tieBreaker},</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Priority{Priority: local.Priority()},</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Priority{Priority: local.Priority()},</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.MessageIntegrity{</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.MessageIntegrity{</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Key: []byte(a.remotePwd),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Key: []byte(a.remotePwd),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Fingerprint{},</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Fingerprint{},</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; msg, err = stun.Build(stun.ClassRequest, stun.MethodBinding, transactionID,</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; msg, err = stun.Build(stun.ClassRequest, stun.MethodBinding, transactionID,</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Username{Username: a.remoteUfrag + &quot;:&quot; + a.localUfrag},</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Username{Username: a.remoteUfrag + &quot;:&quot; + a.localUfrag},</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.IceControlled{TieBreaker: a.tieBreaker},</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.IceControlled{TieBreaker: a.tieBreaker},</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Priority{Priority: local.Priority()},</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Priority{Priority: local.Priority()},</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.MessageIntegrity{</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.MessageIntegrity{</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Key: []byte(a.remotePwd),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Key: []byte(a.remotePwd),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Fingerprint{},</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Fingerprint{},</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debug(err.Error())</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debug(err.Error())</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.log.Tracef(&quot;ping STUN from %s to %s\n&quot;, local.String(), remote.String())</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.log.Tracef(&quot;ping STUN from %s to %s\n&quot;, local.String(), remote.String())</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if overflow := len(a.pendingBindingRequests) - maxPendingBindingRequests; overflow &gt; 1 {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if overflow := len(a.pendingBindingRequests) - maxPendingBindingRequests; overflow &gt; 1 {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debugf(&quot;Discarded %d pending binding requests, pendingBindingRequests is full&quot;, overflow)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debugf(&quot;Discarded %d pending binding requests, pendingBindingRequests is full&quot;, overflow)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.pendingBindingRequests = a.pendingBindingRequests[overflow:]</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.pendingBindingRequests = a.pendingBindingRequests[overflow:]</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.pendingBindingRequests = append(a.pendingBindingRequests, bindingRequest{</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.pendingBindingRequests = append(a.pendingBindingRequests, bindingRequest{</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; transactionID: transactionID,</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; transactionID: transactionID,</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination:&nbsp;&nbsp; remote.addr(),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination:&nbsp;&nbsp; remote.addr(),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.sendSTUN(msg, local, remote)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.sendSTUN(msg, local, remote)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) updateConnectionState(newState ConnectionState) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) updateConnectionState(newState ConnectionState) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if a.connectionState != newState {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if a.connectionState != newState {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Infof(&quot;Setting new connection state: %s&quot;, newState)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Infof(&quot;Setting new connection state: %s&quot;, newState)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.connectionState = newState</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.connectionState = newState</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hdlr := a.onConnectionStateChangeHdlr</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hdlr := a.onConnectionStateChangeHdlr</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if hdlr != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if hdlr != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Call handler async since we may be holding the agent lock</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Call handler async since we may be holding the agent lock</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // and the handler may also require it</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // and the handler may also require it</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; go hdlr(newState)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; go hdlr(newState)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) setValidPair(local, remote *Candidate, selected, controlling bool) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) setValidPair(local, remote *Candidate, selected, controlling bool) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // TODO: avoid duplicates</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // TODO: avoid duplicates</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; p := newCandidatePair(local, remote, controlling)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; p := newCandidatePair(local, remote, controlling)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.log.Tracef(&quot;Found valid candidate pair: %s (selected? %t)&quot;, p, selected)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.log.Tracef(&quot;Found valid candidate pair: %s (selected? %t)&quot;, p, selected)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if selected {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if selected {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Notify when the selected pair changes</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Notify when the selected pair changes</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !a.selectedPair.Equal(p) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !a.selectedPair.Equal(p) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.onSelectedCandidatePairChange(p)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.onSelectedCandidatePairChange(p)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.selectedPair = p</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.selectedPair = p</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.validPairs = nil</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.validPairs = nil</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // TODO: only set state to connected on selecting final pair?</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // TODO: only set state to connected on selecting final pair?</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.updateConnectionState(ConnectionStateConnected)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.updateConnectionState(ConnectionStateConnected)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // keep track of pairs with succesfull bindings since any of them</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // keep track of pairs with succesfull bindings since any of them</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // can be used for communication until the final pair is selected:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // can be used for communication until the final pair is selected:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // https://tools.ietf.org/html/draft-ietf-ice-rfc5245bis-20#section-12</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // https://tools.ietf.org/html/draft-ietf-ice-rfc5245bis-20#section-12</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.validPairs = append(a.validPairs, p)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.validPairs = append(a.validPairs, p)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Sort the candidate pairs by priority of the remotes</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Sort the candidate pairs by priority of the remotes</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sort.Sort(byPairPriority{a.validPairs})</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sort.Sort(byPairPriority{a.validPairs})</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // Signal connected</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; // Signal connected</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.onConnectedOnce.Do(func() { close(a.onConnected) })</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.onConnectedOnce.Do(func() { close(a.onConnected) })</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// A task is a</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// A task is a</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">type task func(*Agent)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">type task func(*Agent)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) run(t task) error {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) run(t task) error {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; err := a.ok()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; err := a.ok()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return err</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return err</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; select {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; select {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case &lt;-a.done:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case &lt;-a.done:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return a.getErr()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return a.getErr()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case a.taskChan &lt;- t:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case a.taskChan &lt;- t:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return nil</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return nil</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) taskLoop() {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) taskLoop() {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; contactCandidates := func() {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; contactCandidates := func() {</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if a.validateSelectedPair() {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if a.validateSelectedPair() {</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSigDiffMod">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Trace(&quot;checking keepalive&quot;)</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigDiffMod">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegSigDiff">//</span>a.log.Trace(&quot;checking keepalive&quot;)</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigDiffMod">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.checkKeepalive()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigDiffMod">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegSigDiff">//</span>a.checkKeepalive()</td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSigDiffMod">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Trace(&quot;pinging all candidates&quot;)</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigDiffMod">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegSigDiff">//</span>a.log.Trace(&quot;pinging all candidates&quot;)</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigDiffMod">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.pingAllCandidates()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigDiffMod">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegSigDiff">//</span>a.pingAllCandidates()</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; for {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; for {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; select {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; select {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case &lt;-a.forceCandidateContact:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case &lt;-a.forceCandidateContact:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; contactCandidates()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; contactCandidates()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case &lt;-a.connectivityChan:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case &lt;-a.connectivityChan:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; contactCandidates()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; contactCandidates()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case t := &lt;-a.taskChan:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case t := &lt;-a.taskChan:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Run the task</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Run the task</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t(a)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t(a)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case &lt;-a.done:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case &lt;-a.done:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// validateSelectedPair checks if the selected pair is (still) valid</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// validateSelectedPair checks if the selected pair is (still) valid</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// Note: the caller should hold the agent lock.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// Note: the caller should hold the agent lock.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) validateSelectedPair() bool {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) validateSelectedPair() bool {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if a.selectedPair == nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if a.selectedPair == nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Not valid since not selected</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Not valid since not selected</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if (a.connectionTimeout != 0) &amp;&amp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if (a.connectionTimeout != 0) &amp;&amp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (time.Since(a.selectedPair.remote.LastReceived()) &gt; a.connectionTimeout) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (time.Since(a.selectedPair.remote.LastReceived()) &gt; a.connectionTimeout) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.selectedPair = nil</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.selectedPair = nil</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.updateConnectionState(ConnectionStateDisconnected)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.updateConnectionState(ConnectionStateDisconnected)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return true</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return true</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// checkKeepalive sends STUN Binding Indications to the selected pair</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// checkKeepalive sends STUN Binding Indications to the selected pair</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// if no packet has been sent on that pair in the last keepaliveInterval</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// if no packet has been sent on that pair in the last keepaliveInterval</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// Note: the caller should hold the agent lock.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// Note: the caller should hold the agent lock.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) checkKeepalive() {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) checkKeepalive() {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if a.selectedPair == nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if a.selectedPair == nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if (a.keepaliveInterval != 0) &amp;&amp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if (a.keepaliveInterval != 0) &amp;&amp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (time.Since(a.selectedPair.local.LastSent()) &gt; a.keepaliveInterval) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (time.Since(a.selectedPair.local.LastSent()) &gt; a.keepaliveInterval) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.keepaliveCandidate(a.selectedPair.local, a.selectedPair.remote)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.keepaliveCandidate(a.selectedPair.local, a.selectedPair.remote)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// pingAllCandidates sends STUN Binding Requests to all candidates</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// pingAllCandidates sends STUN Binding Requests to all candidates</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// Note: the caller should hold the agent lock.</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// Note: the caller should hold the agent lock.</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) pingAllCandidates() {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) pingAllCandidates() {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; for networkType, localCandidates := range a.localCandidates {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; for networkType, localCandidates := range a.localCandidates {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if remoteCandidates, ok := a.remoteCandidates[networkType]; ok {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if remoteCandidates, ok := a.remoteCandidates[networkType]; ok {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for _, localCandidate := range localCandidates {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for _, localCandidate := range localCandidates {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for _, remoteCandidate := range remoteCandidates {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for _, remoteCandidate := range remoteCandidates {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.pingCandidate(localCandidate, remoteCandidate)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.pingCandidate(localCandidate, remoteCandidate)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// AddRemoteCandidate adds a new remote candidate</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// AddRemoteCandidate adds a new remote candidate</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) AddRemoteCandidate(c *Candidate) error {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) AddRemoteCandidate(c *Candidate) error {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return a.run(func(agent *Agent) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return a.run(func(agent *Agent) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.addRemoteCandidate(c)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.addRemoteCandidate(c)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// addRemoteCandidate assumes you are holding the lock (must be execute using a.run)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// addRemoteCandidate assumes you are holding the lock (must be execute using a.run)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) addRemoteCandidate(c *Candidate) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) addRemoteCandidate(c *Candidate) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; networkType := c.NetworkType</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; networkType := c.NetworkType</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; set := a.remoteCandidates[networkType]</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; set := a.remoteCandidates[networkType]</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; for _, candidate := range set {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; for _, candidate := range set {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if candidate.Equal(c) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if candidate.Equal(c) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; set = append(set, c)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; set = append(set, c)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.remoteCandidates[networkType] = set</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; a.remoteCandidates[networkType] = set</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// GetLocalCandidates returns the local candidates</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// GetLocalCandidates returns the local candidates</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) GetLocalCandidates() ([]*Candidate, error) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) GetLocalCandidates() ([]*Candidate, error) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; res := make(chan []*Candidate)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; res := make(chan []*Candidate)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; err := a.run(func(agent *Agent) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; err := a.run(func(agent *Agent) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var candidates []*Candidate</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var candidates []*Candidate</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for _, set := range agent.localCandidates {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for _, set := range agent.localCandidates {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; candidates = append(candidates, set...)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; candidates = append(candidates, set...)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res &lt;- candidates</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res &lt;- candidates</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return nil, err</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return nil, err</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return &lt;-res, nil</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return &lt;-res, nil</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// GetLocalUserCredentials returns the local user credentials</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// GetLocalUserCredentials returns the local user credentials</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) GetLocalUserCredentials() (frag string, pwd string) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) GetLocalUserCredentials() (frag string, pwd string) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return a.localUfrag, a.localPwd</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return a.localUfrag, a.localPwd</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// Close cleans up the Agent</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// Close cleans up the Agent</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) Close() error {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) Close() error {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; done := make(chan struct{})</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; done := make(chan struct{})</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; err := a.run(func(agent *Agent) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; err := a.run(func(agent *Agent) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; defer func() {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; defer func() {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; close(done)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; close(done)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.err.Store(ErrClosed)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; agent.err.Store(ErrClosed)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; close(agent.done)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; close(agent.done)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Cleanup all candidates</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Cleanup all candidates</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for net, cs := range agent.localCandidates {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for net, cs := range agent.localCandidates {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for _, c := range cs {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for _, c := range cs {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err := c.close()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err := c.close()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;Failed to close candidate %s: %v&quot;, c, err)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;Failed to close candidate %s: %v&quot;, c, err)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delete(agent.localCandidates, net)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delete(agent.localCandidates, net)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for net, cs := range agent.remoteCandidates {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for net, cs := range agent.remoteCandidates {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for _, c := range cs {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for _, c := range cs {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err := c.close()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err := c.close()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;Failed to close candidate %s: %v&quot;, c, err)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;Failed to close candidate %s: %v&quot;, c, err)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delete(agent.remoteCandidates, net)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delete(agent.remoteCandidates, net)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err := a.buffer.Close()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err := a.buffer.Close()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;failed to close buffer: %v&quot;, err)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;failed to close buffer: %v&quot;, err)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return err</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return err</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">-+</td>
<td class="TextItemSigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">GetIceServer().RmvAgent(a)</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &lt;-done</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &lt;-done</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return nil</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return nil</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) findRemoteCandidate(networkType NetworkType, addr net.Addr) *Candidate {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) findRemoteCandidate(networkType NetworkType, addr net.Addr) *Candidate {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; var ip net.IP</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; var ip net.IP</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; var port int</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; var port int</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; switch casted := addr.(type) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; switch casted := addr.(type) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case *net.UDPAddr:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case *net.UDPAddr:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ip = casted.IP</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ip = casted.IP</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = casted.Port</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = casted.Port</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case *net.TCPAddr:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; case *net.TCPAddr:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ip = casted.IP</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ip = casted.IP</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = casted.Port</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = casted.Port</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; default:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; default:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;unsupported address type %T&quot;, a)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;unsupported address type %T&quot;, a)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return nil</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return nil</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; set := a.remoteCandidates[networkType]</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; set := a.remoteCandidates[networkType]</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; for _, c := range set {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; for _, c := range set {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; base := c</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; base := c</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if base.IP.Equal(ip) &amp;&amp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if base.IP.Equal(ip) &amp;&amp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; base.Port == port {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; base.Port == port {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return c</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return c</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return nil</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return nil</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">func (a *Agent) sendBindingSuccess(m *stun.Message, local, remote *Candidate) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) sendBindingSuccess(m *stun.Message, local, remote *Candidate) {</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">-+</td>
<td class="TextItemSigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">//</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">a.log.Debugf(&quot;localUfrag:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">%s,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">remoteUfrag:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">%s&quot;,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">a.localUfrag,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">a.remoteUfrag)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">//</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">a.log.Debugf(&quot;remote</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">IP:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">%s,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">Port:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">%d,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">localPwd</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">%s&quot;,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">remote.IP,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">remote.Port,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">a.localPwd)</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; base := remote</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; base := remote</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if out, err := stun.Build(stun.ClassSuccessResponse, stun.MethodBinding, m.TransactionID,</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if out, err := stun.Build(stun.ClassSuccessResponse, stun.MethodBinding, m.TransactionID,</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.XorMappedAddress{</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.XorMappedAddress{</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XorAddress: stun.XorAddress{</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XorAddress: stun.XorAddress{</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IP:&nbsp;&nbsp; base.IP,</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IP:&nbsp;&nbsp; base.IP,</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Port: base.Port,</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Port: base.Port,</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">-+</td>
<td class="TextItemSigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">&amp;stun.Username{Username:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">a.localUfrag</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">+</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">&quot;:&quot;</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">+</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">a.remoteUfrag},</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.MessageIntegrity{</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.MessageIntegrity{</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Key: []byte(a.localPwd),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Key: []byte(a.localPwd),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Fingerprint{},</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;stun.Fingerprint{},</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; ); err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; ); err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;Failed to handle inbound ICE from: %s to: %s error: %s&quot;, local, remote, err)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;Failed to handle inbound ICE from: %s to: %s error: %s&quot;, local, remote, err)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.sendSTUN(out, local, remote)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.sendSTUN(out, local, remote)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// Assert that the passed TransactionID is in our pendingBindingRequests and returns the destination</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// Assert that the passed TransactionID is in our pendingBindingRequests and returns the destination</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// If the bindingRequest was valid remove it from our pending cache</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// If the bindingRequest was valid remove it from our pending cache</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) handleInboundBindingSuccess(id []byte) (bool, net.Addr) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) handleInboundBindingSuccess(id []byte) (bool, net.Addr) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; for i := range a.pendingBindingRequests {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; for i := range a.pendingBindingRequests {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if bytes.Equal(a.pendingBindingRequests[i].transactionID, id) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if bytes.Equal(a.pendingBindingRequests[i].transactionID, id) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; defer func() {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; defer func() {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.pendingBindingRequests = append(a.pendingBindingRequests[:i], a.pendingBindingRequests[i+1:]...)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.pendingBindingRequests = append(a.pendingBindingRequests[:i], a.pendingBindingRequests[i+1:]...)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }()</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }()</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return true, a.pendingBindingRequests[i].destination</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return true, a.pendingBindingRequests[i].destination</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return false, nil</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return false, nil</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// handleInbound processes STUN traffic from a remote candidate</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// handleInbound processes STUN traffic from a remote candidate</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) handleInbound(m *stun.Message, local *Candidate, remote net.Addr) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) handleInbound(m *stun.Message, local *Candidate, remote net.Addr) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; var err error</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; var err error</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if m == nil || local == nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if m == nil || local == nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else if m.Method != stun.MethodBinding || !(m.Class == stun.ClassSuccessResponse || m.Class == stun.ClassRequest) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else if m.Method != stun.MethodBinding || !(m.Class == stun.ClassSuccessResponse || m.Class == stun.ClassRequest) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Tracef(&quot;unhandled STUN from %s to %s class(%s) method(%s)&quot;, remote.String(), local.String(), m.Method.String(), m.Class.String())</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Tracef(&quot;unhandled STUN from %s to %s class(%s) method(%s)&quot;, remote.String(), local.String(), m.Method.String(), m.Class.String())</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if a.isControlling {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if a.isControlling {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if _, isControlling := m.GetOneAttribute(stun.AttrIceControlling); isControlling {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if _, isControlling := m.GetOneAttribute(stun.AttrIceControlling); isControlling {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debug(&quot;inbound isControlling &amp;&amp; a.isControlling == true&quot;)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debug(&quot;inbound isControlling &amp;&amp; a.isControlling == true&quot;)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if _, useCandidate := m.GetOneAttribute(stun.AttrUseCandidate); useCandidate {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if _, useCandidate := m.GetOneAttribute(stun.AttrUseCandidate); useCandidate {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debug(&quot;useCandidate &amp;&amp; a.isControlling == true&quot;)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debug(&quot;useCandidate &amp;&amp; a.isControlling == true&quot;)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if _, isControlled := m.GetOneAttribute(stun.AttrIceControlled); isControlled {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if _, isControlled := m.GetOneAttribute(stun.AttrIceControlled); isControlled {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debug(&quot;inbound isControlled &amp;&amp; a.isControlling == false&quot;)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debug(&quot;inbound isControlled &amp;&amp; a.isControlling == false&quot;)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remoteCandidate := a.findRemoteCandidate(local.NetworkType, remote)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remoteCandidate := a.findRemoteCandidate(local.NetworkType, remote)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if m.Class == stun.ClassSuccessResponse {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if m.Class == stun.ClassSuccessResponse {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if err = assertInboundMessageIntegrity(m, []byte(a.remotePwd)); err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if err = assertInboundMessageIntegrity(m, []byte(a.remotePwd)); err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;discard message from (%s), %v&quot;, remote, err)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;discard message from (%s), %v&quot;, remote, err)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ok, transactionAddr := a.handleInboundBindingSuccess(m.TransactionID)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ok, transactionAddr := a.handleInboundBindingSuccess(m.TransactionID)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !ok {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !ok {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Errorf(&quot;discard message from (%s), invalid TransactionID %s&quot;, remote, m.TransactionID)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Errorf(&quot;discard message from (%s), invalid TransactionID %s&quot;, remote, m.TransactionID)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Assert that NAT is not symmetric</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Assert that NAT is not symmetric</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // https://tools.ietf.org/html/rfc8445#section-7.2.5.2.1</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // https://tools.ietf.org/html/rfc8445#section-7.2.5.2.1</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !addrEqual(transactionAddr, remote) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !addrEqual(transactionAddr, remote) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debugf(&quot;discard message: transaction source and destination does not match expected(%s), actual(%s)&quot;, transactionAddr, remote)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debugf(&quot;discard message: transaction source and destination does not match expected(%s), actual(%s)&quot;, transactionAddr, remote)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if remoteCandidate == nil { // Should fail previous check, better to be safe though</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if remoteCandidate == nil { // Should fail previous check, better to be safe though</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;discard success message from (%s), no such remote&quot;, remote)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;discard success message from (%s), no such remote&quot;, remote)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Tracef(&quot;inbound STUN (SuccessResponse) from %s to %s&quot;, remote.String(), local.String())</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Tracef(&quot;inbound STUN (SuccessResponse) from %s to %s&quot;, remote.String(), local.String())</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Remember the working pair and select it when receiving a success response</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Remember the working pair and select it when receiving a success response</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.setValidPair(local, remoteCandidate, true, true)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.setValidPair(local, remoteCandidate, true, true)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; } else {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if err = assertInboundUsername(m, a.localUfrag+&quot;:&quot;+a.remoteUfrag); err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if err = assertInboundUsername(m, a.localUfrag+&quot;:&quot;+a.remoteUfrag); err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;discard message from (%s), %v&quot;, remote, err)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;discard message from (%s), %v&quot;, remote, err)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if err = assertInboundMessageIntegrity(m, []byte(a.localPwd)); err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if err = assertInboundMessageIntegrity(m, []byte(a.localPwd)); err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;discard message from (%s), %v&quot;, remote, err)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Warnf(&quot;discard message from (%s), %v&quot;, remote, err)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if remoteCandidate == nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if remoteCandidate == nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ip, port, networkType, ok := parseAddr(remote)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ip, port, networkType, ok := parseAddr(remote)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !ok {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !ok {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Errorf(&quot;Failed to create parse remote net.Addr when creating remote prflx candidate&quot;)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Errorf(&quot;Failed to create parse remote net.Addr when creating remote prflx candidate&quot;)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prflxCandidate, err := NewCandidatePeerReflexive(networkType.String(), ip, port, local.Component, &quot;&quot;, 0)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prflxCandidate, err := NewCandidatePeerReflexive(networkType.String(), ip, port, local.Component, &quot;&quot;, 0)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Errorf(&quot;Failed to create new remote prflx candidate (%s)&quot;, err)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Errorf(&quot;Failed to create new remote prflx candidate (%s)&quot;, err)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; remoteCandidate = prflxCandidate</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; remoteCandidate = prflxCandidate</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debugf(&quot;adding a new peer-reflexive candiate: %s &quot;, remote)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Debugf(&quot;adding a new peer-reflexive candiate: %s &quot;, remote)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.addRemoteCandidate(remoteCandidate)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.addRemoteCandidate(remoteCandidate)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Tracef(&quot;inbound STUN (Request) from %s to %s&quot;, remote.String(), local.String())</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.log.Tracef(&quot;inbound STUN (Request) from %s to %s&quot;, remote.String(), local.String())</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Send success response</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Send success response</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.sendBindingSuccess(m, local, remoteCandidate)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.sendBindingSuccess(m, local, remoteCandidate)</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">-+</td>
<td class="TextItemInsigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">if</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">_,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">useCandidate</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">:=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">m.GetOneAttribute(stun.AttrUseCandidate);</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">!useCandidate</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">a.setValidPair(local,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">remoteCandidate,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">true,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">false)</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigRightMod"><span class="TextSegInsigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">}</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remoteCandidate.seen(false)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remoteCandidate.seen(false)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// noSTUNSeen processes non STUN traffic from a remote candidate,</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// noSTUNSeen processes non STUN traffic from a remote candidate,</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">// and returns true if it is an actual remote candidate</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">// and returns true if it is an actual remote candidate</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) noSTUNSeen(local *Candidate, remote net.Addr) bool {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) noSTUNSeen(local *Candidate, remote net.Addr) bool {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remoteCandidate := a.findRemoteCandidate(local.NetworkType, remote)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remoteCandidate := a.findRemoteCandidate(local.NetworkType, remote)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if remoteCandidate == nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if remoteCandidate == nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remoteCandidate.seen(false)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; remoteCandidate.seen(false)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return true</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return true</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">func (a *Agent) getBestPair() (*candidatePair, error) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">func (a *Agent) getBestPair() (*candidatePair, error) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; res := make(chan *candidatePair)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; res := make(chan *candidatePair)</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; err := a.run(func(agent *Agent) {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; err := a.run(func(agent *Agent) {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if agent.selectedPair != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if agent.selectedPair != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res &lt;- agent.selectedPair</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res &lt;- agent.selectedPair</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for _, p := range agent.validPairs {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for _, p := range agent.validPairs {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res &lt;- p</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res &lt;- p</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res &lt;- nil</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res &lt;- nil</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; })</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if err != nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return nil, err</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return nil, err</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; out := &lt;-res</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; out := &lt;-res</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if out == nil {</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; if out == nil {</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return nil, ErrNoCandidatePairs</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return nil, ErrNoCandidatePairs</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; }</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return out, nil</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp; &nbsp; &nbsp; &nbsp; return out, nil</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">}</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">}</td>
</tr>
</table>
<br/>
</body>
</html>
